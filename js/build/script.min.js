function inherit(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a}!function(){function a(a){a instanceof Array?a.forEach(function(a){b(a)}):b(a)}function b(a){if(f[a])return f[a];var b=new Image;b.onload=function(){f[a]=b,d()&&g.forEach(function(a){a()})},f[a]=!1,b.src=a}function c(a){return f[a]}function d(){var a=!0;for(var b in f)f.hasOwnProperty(b)&&!f[b]&&(a=!1);return a}function e(a){g.push(a)}var f={},g=[];window.Resources={load:a,get:c,onReady:e,isReady:d}}();var Map=function(){this.tileWidth=50,this.tileHeight=41,this.numColumns=11,this.numRows=15,this.totalWidth=this.tileWidth*this.numColumns,this.totalHeight=this.tileHeight*(this.numRows+1),this.mapTiles=["images/white-block.png","images/water-block.png","images/stone-block.png","images/grass-block.png","images/water-block2.png"],this.rowImages=[this.mapTiles[0],this.mapTiles[0],this.mapTiles[3],this.mapTiles[4],this.mapTiles[4],this.mapTiles[4],this.mapTiles[3],this.mapTiles[2],this.mapTiles[2],this.mapTiles[2],this.mapTiles[3],this.mapTiles[2],this.mapTiles[2],this.mapTiles[2],this.mapTiles[3]],this.buffer=24.75,this.xValues={},this.yValues={},this.enemyRows=[6,7,8,10,11,12],this.clouds=["images/cloud1.png","images/cloud2.png","images/cloud3.png","images/cloud4.png","images/cloud5.png","images/cloud6.png","images/cloud7.png"],this.variousImages=["images/Selector.png","images/Star.png","images/Rock.png","images/Key.png","images/Heart.png","images/corn.png","images/Blue.png","images/Green.png","images/Orange.png","images/Purple.png","images/Yellow.png","images/Black.png","images/White.png","images/Red.png","images/Arrows.png","images/Mute.png","images/Enter.png"],this.enemySprites=["images/enemy-bug-right.png","images/enemy-bug-left.png","images/enemy-bug-up.png","images/enemy-bug-down.png","images/enemy-bug-burrow-1.png","images/enemy-bug-burrow-2.png","images/DuckRight.png","images/DuckRightEat.png","images/DuckLeft.png","images/DuckLeftEat.png"],this.playerChars=["images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png"],this.playerCharsHurt=["images/char-boy-hurt.png","images/char-cat-girl-hurt.png","images/char-horn-girl-hurt.png","images/char-pink-girl-hurt.png","images/char-princess-girl-hurt.png"],this.playerCharsHappy=["images/char-boy-happy.png","images/char-cat-girl-happy.png","images/char-horn-girl-happy.png","images/char-pink-girl-happy.png","images/char-princess-girl-happy.png"],this.playerCharsShield=["images/char-boy-shield.png","images/char-cat-girl-shield.png","images/char-horn-girl-shield.png","images/char-pink-girl-shield.png","images/char-princess-girl-shield.png"],this.playerCharsLasso=["images/char-boy-lasso.png","images/char-cat-girl-lasso.png","images/char-horn-girl-lasso.png","images/char-pink-girl-lasso.png","images/char-princess-girl-lasso.png"],this.playerCharsWater=["images/char-boy-water.png","images/char-cat-girl-water.png","images/char-horn-girl-water.png","images/char-pink-girl-water.png","images/char-princess-girl-water.png"],this.slowCorn=70,this.medCorn=-100,this.fastCorn=120,this.powerUpCount=0,this.powerUpMax=2,this.powerUpDelay=4,this.powerUpsLeft=4,this.round=1,this.audio={muted:!1,burrow:new Audio("audio/burrow.mp3"),chime:new Audio("audio/chime.mp3"),chaching:new Audio("audio/chaching.mp3"),flip:new Audio("audio/flip.mp3"),gong:new Audio("audio/gong.mp3"),key:new Audio("audio/key.mp3"),music:new Audio("audio/music.mp3"),nom:new Audio("audio/nom.mp3"),powerdown:new Audio("audio/powerdown.mp3"),quack:new Audio("audio/quack.mp3"),run:new Audio("audio/run.mp3"),shield:new Audio("audio/shield.mp3"),splash:new Audio("audio/splash.mp3"),thud:new Audio("audio/thud.mp3"),time:new Audio("audio/time.mp3"),trumpet:new Audio("audio/trumpet.mp3"),unburrow:new Audio("audio/unburrow.mp3"),yeehaw:new Audio("audio/yeehaw.mp3")},this.lastTwentySounds=[],this.currentMusic=this.audio.music,this.disallowedKeys=[32,37,38,39,40]};Map.prototype.playSFX=function(a){this.audio.muted||(this.audio[a].play(),map.lastTwentySounds.length<20&&map.lastTwentySounds.push(this.audio[a]))},Map.prototype.update=function(a){this.powerUpCount<this.powerUpMax&&this.powerUpsLeft>0&&(this.powerUpDelay>0&&!player.paused&&player.charSelected?this.powerUpDelay-=a:this.powerUpDelay<=0&&!player.paused&&(this.powerUpDelay=5,this.powerUpsLeft--,this.powerUpCount++,allPowerUps.push(new PowerUp)))},Map.prototype.makeCoordinates=function(){for(var a=0;a<this.numColumns;a++)this.xValues[a]=this.tileWidth*a;for(a=0;a<this.numRows;a++)this.yValues[a]=this.buffer+this.tileHeight*a},Map.prototype.canGo=function(a,b){return 9===b&&1!==a&&5!==a&&9!==a||5===b&&3!==a&&7!==a||0===b||b===map.numRows-1?!1:!0},Map.prototype.makeKeys=function(){allKeys.length=0,allKeys.push(new Key(1)),allKeys.push(new Key(5)),allKeys.push(new Key(9))},Map.prototype.playMusic=function(){this.audio.muted||(this.currentMusic.play(),this.currentMusic.volume=.2,this.currentMusic.loop=!0)},Map.prototype.addClouds=function(a){for(var b=0;a>b;b++)allClouds.push(new Cloud)},Map.prototype.addEnemies=function(a){for(var b=0;a>b;b++)allEnemies.push(new Enemy)},Map.prototype.addDucks=function(a){for(var b=0;a>b;b++)allDucks.push(new Duck)},Map.prototype.addCorn=function(){for(var a=0;4>a;a++)allCorn.push(new Corn(2,3.5*map.tileWidth*a-map.tileWidth,map.slowCorn));for(a=0;3>a;a++)allCorn.push(new Corn(3,5*map.tileWidth*a,map.medCorn));for(a=0;3>a;a++)allCorn.push(new Corn(4,4.5*map.tileWidth*a,map.fastCorn))},Map.prototype.setEnemies=function(a){allEnemies.length=0,this.addEnemies(a)};var Entity=function(){this.x=0,this.y=0,this.moving=1,this.sprite=""};Entity.prototype.render=function(){player.charSelected===!0&&ctx.drawImage(Resources.get(this.sprite),this.x,this.y)},Entity.prototype.togglePause=function(){0===this.moving?this.moving=1:this.moving=0},Entity.prototype.blurPause=function(){this.moving=0};var Cloud=function(){this.x=-400-110*Math.random(),this.y=Math.random()*map.totalHeight,this.sprite=map.clouds[Math.floor(7*Math.random())],this.moving=1,this.speed=20+80*Math.random(),this.respawn=!0};inherit(Cloud,Entity),Cloud.prototype.keepMoving=function(){for(var a=allClouds.length,b=0;a>b;b++)allClouds[b].moving=2,allClouds[b].respawn=!1},Cloud.prototype.moveNormally=function(){for(var a=allClouds.length,b=0;a>b;b++)allClouds[b].moving=1,allClouds[b].respawn=!0},Cloud.prototype.update=function(a){this.x+=this.speed*a*this.moving,this.x>map.totalWidth+100&&this.respawn&&(this.x=-410+120*Math.random(),this.y=map.tileWidth+Math.random()*map.totalHeight,this.sprite=map.clouds[Math.floor(7*Math.random())],this.speed=20+80*Math.random())};var Corn=function(a,b,c){this.sprite=map.variousImages[5],this.x=b,this.y=this.cornRow(a),this.speed=c,this.moving=1,this.gemSpeed=1};inherit(Corn,Entity),Corn.prototype.update=function(a){this.x=this.x+this.speed*a*this.moving*this.gemSpeed,this.x>map.totalWidth+2.5*map.tileWidth&&(this.x=-2*map.tileWidth),this.x<-2.5*map.tileWidth&&(this.x=map.totalWidth+2*map.tileWidth)},Corn.prototype.cornRow=function(a){return map.yValues[a]};var PowerUp=function(){var a=function(){var a=[6,7,8,9,10,11,12,13];return a[Math.floor(Math.random()*a.length)]}();this.moving=1,this.movingRight=!1,this.gem=function(){return 6===a?"time":7===a?"shield":8===a?"fast":9===a?"water":10===a?"lasso":11===a?"points":12===a?"slow":13===a?"reverse":void 0}(),this.sprite=map.variousImages[a],this.y=Enemy.prototype.startY(),this.speed=25+25*Math.random(),this.x=function(){var a=[-100,map.totalWidth+100];return a[Math.floor(2*Math.random())]}()};inherit(PowerUp,Entity),PowerUp.prototype.update=function(a){this.x>-50&&!this.movingRight?this.x-=this.moving*this.speed*a:this.x<=-40&&!this.movingRight?this.movingRight=!0:this.movingRight&&this.x<=map.totalWidth+50?this.x+=this.moving*this.speed*a:this.movingRight=!1};var Key=function(a){this.moving=1,this.collected=!1,this.lasso=!1,this.throwDelay=30,this.collectedOffset=Math.floor(Math.random()*map.tileWidth*3),this.sprite=map.variousImages[3],this.x=map.xValues[a],this.y=map.yValues[1]};inherit(Key,Entity),Key.prototype.update=function(a){this.collected&&(this.throwDelay>0?this.throwDelay-=100*a*this.moving:(this.x<map.xValues[map.numColumns-4]+this.collectedOffset&&(this.x=this.x+100*a*(map.xValues[map.numColumns-2]/this.x)*this.moving),this.y<map.yValues[map.numRows-2]&&(this.y=this.y+300*a*this.moving))),this.lasso&&!this.collected&&(this.x>player.x?this.x-=230*a*this.moving:this.x<player.x&&(this.x+=230*a*this.moving),this.y>player.y?this.y-=100*a*this.moving:this.y<player.y&&(this.y+=100*a*this.moving))};var Enemy=function(){this.sprite="",this.x=this.startX(),this.y=this.startY(),this.xSpeed=0,this.ySpeed=0,this.gemSpeed=1,this.zigzag=!1,this.alterDirCount=2+15*Math.random(),this.moving=1,this.frozen=1};inherit(Enemy,Entity),Enemy.prototype.startX=function(){return Math.random()*map.totalWidth*1},Enemy.prototype.startY=function(){return map.yValues[map.enemyRows[Math.floor(Math.random()*map.enemyRows.length)]]},Enemy.prototype.update=function(a){this.x=this.x+this.xSpeed*a*this.moving*this.gemSpeed*this.frozen,this.y=this.y+this.ySpeed*a*this.moving*this.gemSpeed*this.frozen,0===this.xSpeed&&0===this.ySpeed&&this.initialSpeed(),this.zigzag&&this.handleZigzag(a),this.updateSprite(),(this.x<-100||this.x>map.totalWidth+100)&&this.resetTrack()},Enemy.prototype.resetTrack=function(){this.y=this.startY(),this.y===map.yValues[10]||this.y===map.yValues[7]?(this.x=map.totalWidth+80,this.xSpeed=this.newSpeed("left")):(this.x=-80,this.xSpeed=this.newSpeed("right"))},Enemy.prototype.initialSpeed=function(){this.y===map.yValues[10]||this.y===map.yValues[7]?this.xSpeed=this.newSpeed("left"):this.xSpeed=this.newSpeed("right")},Enemy.prototype.updateSprite=function(){this.xSpeed>0&&(this.sprite=map.enemySprites[0]),this.xSpeed<0&&(this.sprite=map.enemySprites[1]),this.ySpeed<0&&(this.sprite=map.enemySprites[2]),this.ySpeed>0&&(this.sprite=map.enemySprites[3])},Enemy.prototype.handleZigzag=function(a){1===this.moving&&(this.alterDirCount-=a*this.frozen),this.alterDirCount<=0&&this.alterDirection(),this.y<=map.yValues[6]&&this.ySpeed<0&&this.alterDirectionSide(),this.y>=map.yValues[8]&&this.y<map.yValues[9]&&this.ySpeed>0&&this.alterDirectionSide(),this.y<=map.yValues[10]&&this.y>map.yValues[9]&&this.ySpeed<0&&this.alterDirectionSide(),this.y>=map.yValues[12]&&this.ySpeed>0&&this.alterDirectionSide()},Enemy.prototype.activateZigzag=function(){for(var a=allEnemies.length,b=0;a>b;b++)allEnemies[b].zigzag=!0},Enemy.prototype.alterDirectionSide=function(){var a=["left","right"],b=Math.abs(this.ySpeed);this.ySpeed=0;var c=a[Math.floor(2*Math.random())];"left"===c?this.xSpeed=-1*b:"right"===c&&(this.xSpeed=b)},Enemy.prototype.alterDirection=function(){this.alterDirCount=2+15*Math.random();var a,b=["left","up","down","right"];a=0===this.xSpeed?Math.abs(this.ySpeed):Math.abs(this.xSpeed),this.xSpeed=0,this.ySpeed=0;var c=b[Math.floor(4*Math.random())];"left"===c?this.xSpeed=-1*a:"right"===c?this.xSpeed=a:"up"===c?this.ySpeed=-1*a:"down"===c&&(this.ySpeed=a)},Enemy.prototype.newSpeed=function(a){return"right"===a?map.tileWidth/2+Math.random()*map.tileWidth*3:"left"===a?map.tileWidth/-2+Math.random()*map.tileWidth*-3:void 0};var Burrower=function(a){this.sprite=map.enemySprites[4],this.x=-100,this.y=-100,this.type=a,this.lastBurrow=5,this.burrowWait=5,this.unburrowed=0,this.moving=1,this.frozen=1};inherit(Burrower,Entity),Burrower.prototype.update=function(a){this.burrowWait>=0&&(this.burrowWait-=a*this.moving*this.frozen),this.unburrowed<=1||this.unburrowed>=2.5?this.sprite=map.enemySprites[4]:this.sprite=map.enemySprites[5],1===this.type&&this.burrowWait<=0&&this.unburrowed<=0&&this.unburrow(),2===this.type&&this.burrowWait<=0&&this.unburrowed<=0&&this.unburrow2(),this.unburrowed>0&&(this.unburrowed-=a*this.moving*this.frozen),this.unburrowed<=0&&this.burrowWait<=0&&this.hide()},Burrower.prototype.unburrow=function(){map.playSFX("unburrow"),this.unburrowed=3,5===this.lastBurrow?(this.lastBurrow=1,this.x=map.xValues[3],this.y=map.yValues[5]):(1===this.lastBurrow?(this.x=map.xValues[7],this.y=map.yValues[5]):2===this.lastBurrow?(this.x=map.xValues[1],this.y=map.yValues[9]):3===this.lastBurrow?(this.x=map.xValues[5],this.y=map.yValues[9]):4===this.lastBurrow&&(this.x=map.xValues[9],this.y=map.yValues[9]),this.lastBurrow++)},Burrower.prototype.unburrow2=function(){map.playSFX("unburrow"),this.unburrowed=1+4*Math.random(),this.y=map.yValues[13],this.x=map.xValues[Math.floor(Math.random()*map.numColumns)]},Burrower.prototype.hide=function(a){map.audio.burrow.volume=.3,map.playSFX("burrow"),this.x=-100,this.y=-100,1===this.type?this.burrowWait=5:this.burrowWait=2+4*Math.random()},Burrower.prototype.resetBurrow=function(){for(var a=allEnemies.length,b=0;a>b;b++)allEnemies[b].burrowWait=5,allEnemies[b]instanceof Burrower&&(allEnemies[b].x=-100)};var Duck=function(){this.sprite=map.enemySprites[6],this.isDuck=!0,this.x=-300,this.y=-300,this.quackX=-100,this.quackY=-100,this.quackWarning=0,this.quacked1=!0,this.quacked2=!0,this.duckWait=5+10*Math.random(),this.moving=1,this.frozen=1,this.notOpposed=!0,this.reassignSprite=0,this.goingRight=!0,this.gemSpeed=1};inherit(Duck,Entity),Duck.prototype.update=function(a){this.reassignSprite>0&&(this.reassignSprite-=a),this.reassignSprite>0&&this.reassignSprite<.1&&(this.goingRight?this.sprite=map.enemySprites[6]:this.sprite=map.enemySprites[8]),this.duckWait<=0&&this.strike(),this.duckWait>0&&(this.duckWait-=a*this.moving*this.frozen*this.gemSpeed),this.quackWarning>0&&(this.quackWarning-=a*this.moving*this.gemSpeed),this.goingRight?(this.x+=350*a*this.moving*this.frozen*this.gemSpeed,this.quackX>-100&&this.notOpposed&&(this.quackX-=150*a*this.moving*this.gemSpeed)):(this.x-=350*a*this.moving*this.frozen*this.gemSpeed,this.quackX<map.totalWidth+100&&this.notOpposed&&(this.quackX+=150*a*this.moving*this.gemSpeed)),this.notOpposed=!0,this.quackWarning>3.6&&this.quackWarning<4&&this.duckWarn(a),this.quackWarning<3.9&&!this.quacked1&&(this.quacked1=!0,map.playSFX("quack")),this.quackWarning>2.2&&this.quackWarning<2.6&&this.duckWarn(a),this.quackWarning<2.5&&!this.quacked2&&(this.quacked2=!0,map.playSFX("quack"))},Duck.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y),this.quackWarning>0&&(this.goingRight?ctx.textAlign="left":ctx.textAlign="right",ctx.font="20px Impact",ctx.fillStyle="yellow",ctx.strokeStyle="black",ctx.lineWidth=1,ctx.fillText("Quack!",this.quackX,this.quackY),ctx.strokeText("Quack!",this.quackX,this.quackY))},Duck.prototype.strike=function(){this.quacked1=!1,this.quacked2=!1,this.quackWarning=4;var a=["left","right"],b=[1,2,3,4];this.duckWait=8+17*Math.random();var c=a[Math.floor(2*Math.random())],d=b[Math.floor(4*Math.random())];"left"===c?(this.sprite=map.enemySprites[6],this.x=-1300,this.quackXGoal=40,this.quackX=-100,this.goingRight=!0):"right"===c&&(this.sprite=map.enemySprites[8],this.x=map.totalWidth+1300,this.quackXGoal=map.totalWidth-40,this.quackX=map.totalWidth+100,this.goingRight=!1),this.y=map.yValues[d],this.quackY=this.y+65},Duck.prototype.duckEat=function(){map.playSFX("nom"),this.goingRight?this.sprite=map.enemySprites[7]:this.sprite=map.enemySprites[9],this.reassignSprite=.25},Duck.prototype.duckWarn=function(a){this.goingRight?this.quackX+=350*a*this.moving*this.frozen*this.gemSpeed:this.quackX>this.quackXGoal&&(this.quackX-=350*a*this.moving*this.frozen*this.gemSpeed),this.notOpposed=!1};var Player=function(){this.sprite="",this.x=0,this.y=0,this.xCoord=0,this.yCoord=0,this.paused=!1,this.victory=!1,this.keysHeld=0,this.ouch=!1,this.drowned=!1,this.isDead=!1,this.livesLeft=5,this.victorySpot=0,this.movingUp=!0,this.floating=!1,this.speed=null,this.gemSpeed=1,this.moving=1,this.charSelected=!1,this.selectX=map.totalWidth/2-260,this.selectY=9*map.tileHeight,this.charOptions=map.playerChars,this.charHappy=map.playerCharsHappy,this.charHurt=map.playerCharsHurt,this.charShield=map.playerCharsShield,this.charLasso=map.playerCharsLasso,this.charWater=map.playerCharsWater,this.selection=0,this.timeLeft=0,this.enemySpeedTime=0,this.freeze=0,this.shield=0,this.water=0,this.lasso=0,this.counting=!1,this.points=0,this.latestPoints=0,this.pointsY=-200,this.pointsScreen=!1,this.musicNotStarted=!0,this.isFood=!1};Player.prototype.character=function(){this.musicNotStarted&&(this.musicNotStarted=!1,map.playMusic()),this.topIntroText(),this.charSelection(),this.charChoices()},Player.prototype.update=function(a){var b=allCorn.length,c=allEnemies.length,d=allDucks.length,e=allKeys.length,f=allPowerUps.length;if(3!==this.keysHeld||this.victory||(map.playSFX("trumpet"),this.keysHeld=0,this.victory=!0,this.victorySpot=this.y,this.sprite=this.charHappy[this.selection],this.winPoints(100+20*Math.ceil(this.timeLeft),"victory"),this.blurPause()),this.pointsY>-200&&(this.pointsY-=150*a),this.charSelected&&window.addEventListener("blur",function(){player.blurPause()}),this.enemySpeedTime>=0)this.enemySpeedTime-=a*this.moving;else if(this.enemySpeedTime<=0&&this.enemySpeedTime>=-1){this.enemySpeedTime-=2,this.gemSpeed=1;for(var g=0;c>g;g++)allEnemies[g].gemSpeed=1;for(g=0;d>g;g++)allDucks[g].gemSpeed=1;for(g=0;b>g;g++)allCorn[g].gemSpeed=1}if(this.extention=0,this.lasso>0&&(this.lasso-=a*this.moving,this.extention=100),this.water>0&&(this.water-=a*this.moving),this.shield>0&&(this.shield-=a*this.moving),this.changeSprite(),this.floating&&(this.trackPosition(),this.x+=this.speed*a*this.moving*this.gemSpeed),!this.paused&&this.timeLeft>=0&&(this.timeLeft-=a*this.moving),this.freeze>0){this.freeze-=a*this.moving;for(var h=0;c>h;h++)allEnemies[h].frozen=0;for(h=0;d>h;h++)allDucks[h].frozen=0}if(this.freeze<=0&&0===allEnemies[0].frozen){for(var i=0;c>i;i++)allEnemies[i].frozen=1;for(i=0;d>i;i++)allDucks[i].frozen=1}for(var j=[],k=0;b>k;k++){var l=allCorn[k].x,m=allCorn[k].y;j.push([l,m])}if(this.floating=!1,2===this.yCoord||3===this.yCoord||4===this.yCoord){for(var n=0;b>n;n++)this.x+30<j[n][0]+2*map.tileWidth&&this.x+25>j[n][0]&&this.y-map.tileHeight/8<j[n][1]&&this.y+map.tileHeight/8>j[n][1]&&(this.floating=!0,this.speed=allCorn[n].speed);this.floating===!1&&this.drown()}1===this.yCoord&&1!==this.xCoord&&5!==this.xCoord&&9!==this.xCoord&&this.drown();var o=[];for(k=0;e>k;k++){var p=allKeys[k].x,q=allKeys[k].y;o.push([p,q])}for(var r=0;e>r;r++)this.x-this.extention<o[r][0]&&this.x+this.extention>o[r][0]&&this.y-this.extention<o[r][1]&&this.y+this.extention>o[r][1]&&this.lasso>0&&(allKeys[r].lasso=!0);for(r=0;e>r;r++)this.x-map.tileWidth/2<o[r][0]&&this.x+map.tileWidth/2>o[r][0]&&this.y-map.tileHeight/8<o[r][1]&&this.y+map.tileHeight/8>o[r][1]&&allKeys[r].collected===!1&&(allKeys[r].collected=!0,map.playSFX("key"),this.keysHeld++,this.winPoints(50));var s=[];for(r=0;f>r;r++){var t=allPowerUps[r].x,u=allPowerUps[r].y;s.push([t,u])}for(r=0;f>r;r++)if(this.x-map.tileWidth/2<s[r][0]&&this.x+map.tileWidth/2>s[r][0]&&this.y-map.tileHeight/8<s[r][1]&&this.y+map.tileHeight/8>s[r][1]){this.pickUp(allPowerUps[r]);break}var v=[];for(k=0;c>k;k++){var w=allEnemies[k].x,x=allEnemies[k].y;v.push([w,x])}for(var y=0;c>y;y++)this.x-map.tileWidth/2<v[y][0]&&this.x+map.tileWidth/2>v[y][0]&&this.y-map.tileHeight/2<v[y][1]&&this.y+map.tileHeight/2>v[y][1]&&this.hit();var z=[];for(k=0;d>k;k++){var A=allDucks[k].x,B=allDucks[k].y;z.push([A,B])}for(y=0;d>y;y++)this.x-map.tileWidth/2<z[y][0]&&this.x>z[y][0]+map.tileWidth/4&&this.y-map.tileHeight/2<z[y][1]&&this.y+map.tileHeight/2>z[y][1]&&this.eaten(allDucks[y]);this.victory===!0&&this.victoryBounce(this.victorySpot,a)},Player.prototype.changeSprite=function(){this.shield>0?this.sprite=this.charShield[this.selection]:this.water>0?this.sprite=this.charWater[this.selection]:this.lasso>0?this.sprite=this.charLasso[this.selection]:this.victory||this.ouch||(this.sprite=this.charOptions[this.selection])},Player.prototype.resetSprite=function(){this.water<.1&&this.shield<.1&&this.lasso<.1&&(this.sprite=this.charOptions[this.selection])},Player.prototype.trackPosition=function(){for(var a=0;a<map.numColumns-1;a++)this.x>map.xValues[a]-25&&this.x<map.xValues[a+1]-25&&(this.xCoord=a)},Player.prototype.move=function(){this.x=map.xValues[this.xCoord],this.y=map.yValues[this.yCoord]},Player.prototype.waterMove=function(a){"left"===a?this.x=this.x-map.tileWidth:"right"===a?this.x=this.x+map.tileWidth:"up"===a?this.y=this.y-map.tileHeight:"down"===a&&(this.y=this.y+map.tileHeight)},Player.prototype.resetStart=function(){this.xCoord=Math.floor(map.numColumns/2),this.yCoord=map.numRows-2,this.move(),this.timeLeft=30},Player.prototype.render=function(){map.audio.muted&&this.charSelected&&ctx.drawImage(Resources.get(map.variousImages[15]),120,map.tileHeight+20),this.announcePoints(this.latestPoints),this.charSelected===!1&&this.character(),this.charSelected===!0&&(this.isFood||ctx.drawImage(Resources.get(this.sprite),this.x,this.y),this.displayTimer(),this.displayPoints(),this.displayHearts(),this.displayRound()),ctx.font="24px Impact",ctx.textAlign="left";var a=map.totalWidth/2.1;this.shield>0&&(ctx.fillStyle="green",ctx.fillText("Shield: "+Math.ceil(this.shield),a,.6*map.tileHeight)),this.freeze>0&&(ctx.fillStyle="blue",ctx.fillText("Freeze: "+Math.ceil(this.freeze),a,1.2*map.tileHeight)),this.water>0&&(ctx.fillStyle="purple",ctx.fillText("Water: "+Math.ceil(this.water),a,1.8*map.tileHeight)),this.enemySpeedTime>0&&(allEnemies[0].gemSpeed>1?ctx.fillStyle="orange":ctx.fillStyle="gray",ctx.fillText("Speed: "+Math.ceil(this.enemySpeedTime),a-100,2.4*map.tileHeight)),this.lasso>0&&(ctx.fillStyle="yellow",ctx.strokeStyle="black",ctx.lineWidth="1",ctx.fillText("Lasso: "+Math.ceil(this.lasso),a,2.4*map.tileHeight),ctx.strokeText("Lasso: "+Math.ceil(this.lasso),a,2.4*map.tileHeight),ctx.lineWidth="2"),this.victory===!0?this.victoryScreen():this.isDead===!0?this.deadScreen():this.isFood?this.foodMessage():this.drowned===!0?this.drownMessage():this.ouch===!0?this.hitMessage():this.paused===!0&&this.pauseMessage()},Player.prototype.winPoints=function(a,b){this.points+=a,this.pointsY=5*map.tileHeight,this.latestPoints=a,b&&(this.latestPoints=a+50)},Player.prototype.announcePoints=function(a){ctx.fillStyle="orange",ctx.strokeStyle="black",ctx.font="56px Impact",ctx.textAlign="center",ctx.lineWidth=2,ctx.fillText("+"+a,map.totalWidth-1.5*map.tileWidth,this.pointsY),ctx.strokeText("+"+a,map.totalWidth-1.5*map.tileWidth,this.pointsY)},Player.prototype.victoryScreen=function(){Cloud.prototype.keepMoving(),Player.prototype.victoryMessage(),Player.prototype.continueMessage()},Player.prototype.deadScreen=function(){Cloud.prototype.keepMoving(),this.deadOverlay(),this.deadMessage(),this.playAgainMessage()},Player.prototype.topIntroText=function(){ctx.fillStyle="black",ctx.textAlign="center",ctx.font="30px Impact",ctx.fillText("Collect the gems,",map.totalWidth/2,map.tileHeight),ctx.fillText("Collect the keys,",map.totalWidth/2,1.75*map.tileHeight),ctx.fillText("Advance to harder rounds!",map.totalWidth/2,2.5*map.tileHeight)},Player.prototype.charSelection=function(){this.bwMsgStyle(),ctx.textAlign="center",ctx.fillText("Select a character",map.totalWidth/2,8.4*map.tileHeight),ctx.strokeText("Select a character",map.totalWidth/2,8.4*map.tileHeight),ctx.fillText("Press enter to choose",map.totalWidth/2,12.9*map.tileHeight),ctx.strokeText("Press enter to choose",map.totalWidth/2,12.9*map.tileHeight),ctx.fillStyle="silver",ctx.fillRect(0,8.6*map.tileHeight,map.totalWidth,140),ctx.strokeRect(0,8.6*map.tileHeight,map.totalWidth,140),ctx.drawImage(Resources.get(map.variousImages[0]),this.selectX,this.selectY)},Player.prototype.charChoices=function(){for(var a=this.charOptions.length,b=map.totalWidth/2-260,c=0;a>c;c++)ctx.drawImage(Resources.get(this.charOptions[c]),b,9*map.tileHeight),b+=112},Player.prototype.victoryMessage=function(){ctx.font="56px Impact",ctx.fillStyle="lime",ctx.strokeStyle="black",ctx.textAlign="center",ctx.lineWidth=2,ctx.fillText("Good job!",canvas.width/2,canvas.height/2),ctx.strokeText("Good job!",canvas.width/2,canvas.height/2)},Player.prototype.continueMessage=function(){ctx.font="40px Impact",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.textAlign="center",ctx.lineWidth=2,ctx.fillText("Press enter to continue",canvas.width/2,canvas.height-60),ctx.strokeText("Press enter to continue",canvas.width/2,canvas.height-60)},Player.prototype.playAgainMessage=function(){ctx.font="40px Impact",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.textAlign="center",ctx.lineWidth=2,ctx.fillText("Press enter to play again!",canvas.width/2,canvas.height-60),ctx.strokeText("Press enter to play again!",canvas.width/2,canvas.height-60)},Player.prototype.bwMsgStyle=function(){ctx.font="40px Impact",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=2},Player.prototype.pauseMessage=function(){this.bwMsgStyle(),ctx.textAlign="center",ctx.fillText('Press "p" to unpause',canvas.width/2,canvas.height/2),ctx.strokeText('Press "p" to unpause',canvas.width/2,canvas.height/2)},Player.prototype.hitMessage=function(){this.hitOverlay(),this.loseLifeMsgStyle(),ctx.fillText("You got hit!",canvas.width/2,canvas.height-140),ctx.strokeText("You got hit!",canvas.width/2,canvas.height-140),this.continueMessage()},Player.prototype.drownMessage=function(){this.loseLifeMsgStyle(),ctx.fillText("You can't swim!",canvas.width/2,canvas.height-140),ctx.strokeText("You can't swim!",canvas.width/2,canvas.height-140),this.continueMessage()},Player.prototype.foodMessage=function(){this.loseLifeMsgStyle(),ctx.fillText("You fed the duck!",canvas.width/2,canvas.height-140),ctx.strokeText("You fed the duck!",canvas.width/2,canvas.height-140),this.continueMessage()},Player.prototype.loseLifeMsgStyle=function(){Cloud.prototype.keepMoving(),ctx.lineWidth=2,ctx.font="56px Impact",ctx.fillStyle="white",ctx.strokeStyle="red",ctx.textAlign="center"},Player.prototype.deadMessage=function(){ctx.font="64px Impact",ctx.fillStyle="black",ctx.strokeStyle="red",ctx.textAlign="center",ctx.lineWidth=2,ctx.fillText(this.points+" points!",canvas.width/2,canvas.height-140),ctx.strokeText(this.points+" points!",canvas.width/2,canvas.height-140)},Player.prototype.togglePause=function(){for(var a=allEnemies.length,b=allCorn.length,c=allKeys.length,d=allDucks.length,e=allClouds.length,f=allPowerUps.length,g=0;a>g;g++)allEnemies[g].togglePause();for(g=0;b>g;g++)allCorn[g].togglePause();for(g=0;c>g;g++)allKeys[g].togglePause();for(g=0;d>g;g++)allDucks[g].togglePause();for(g=0;f>g;g++)allPowerUps[g].togglePause();for(g=0;e>g;g++)allClouds[g].togglePause();this.paused=!this.paused,1===this.moving?this.moving=0:this.moving=1},Player.prototype.blurPause=function(){for(var a=allEnemies.length,b=allCorn.length,c=allKeys.length,d=allDucks.length,e=allClouds.length,f=allPowerUps.length,g=0;a>g;g++)allEnemies[g].blurPause();for(g=0;b>g;g++)allCorn[g].blurPause();for(g=0;c>g;g++)allKeys[g].blurPause();for(g=0;d>g;g++)allDucks[g].blurPause();for(g=0;f>g;g++)allPowerUps[g].blurPause();for(g=0;e>g;g++)allClouds[g].blurPause();this.paused=!0,this.moving=0},Player.prototype.pickUp=function(a){this.gems[a.gem].call(player),map.powerUpCount--;var b=allPowerUps.indexOf(a);allPowerUps.splice(b,1)},Player.prototype.gems={fast:function(){map.playSFX("run"),this.winPoints(150),this.enemySpeedTime=5,this.gemSpeed=1.5;for(var a=allEnemies.length,b=allDucks.length,c=allCorn.length,d=0;a>d;d++)allEnemies[d].gemSpeed=1.5;for(d=0;b>d;d++)allDucks[d].gemSpeed=1.5;for(d=0;c>d;d++)allCorn[d].gemSpeed=1.5},time:function(){map.playSFX("time"),this.winPoints(100),this.timeLeft+=10,this.freeze=6},shield:function(){map.playSFX("shield"),this.winPoints(100),this.shield=5},water:function(){map.playSFX("chime"),this.winPoints(100),this.water=5},lasso:function(){map.playSFX("yeehaw"),this.winPoints(100),this.lasso=8},points:function(){map.playSFX("chaching"),this.winPoints(300)},slow:function(){map.playSFX("powerdown"),this.winPoints(100),this.enemySpeedTime=5,this.gemSpeed=.5;for(var a=allEnemies.length,b=allDucks.length,c=allCorn.length,d=0;a>d;d++)allEnemies[d].gemSpeed=.5;for(d=0;b>d;d++)allDucks[d].gemSpeed=.5;for(d=0;c>d;d++)allCorn[d].gemSpeed=.5},reverse:function(){map.playSFX("flip"),this.winPoints(100);var a=allCorn.length;for(i=0;i<a;i++)allCorn[i].speed*=-1}},Player.prototype.hit=function(){this.paused===!1&&this.shield<=0&&(map.playSFX("thud"),this.resetTimers(),this.loseLife())},Player.prototype.eaten=function(a){this.paused===!1&&this.shield<=0&&(map.playSFX("nom"),a.duckEat(),this.isFood=!0,this.resetTimers(),this.loseLife())},Player.prototype.drown=function(){this.paused===!1&&this.water<=0&&(map.playSFX("splash"),this.drowned=!0,this.resetTimers(),this.loseLife())},Player.prototype.resetTimers=function(){this.enemySpeedTime=0,this.freeze=0,this.shield=0,this.water=0,this.lasso=0},Player.prototype.loseLife=function(){this.blurPause(),this.ouch=!0,this.sprite=this.charHurt[this.selection],this.livesLeft--,this.livesLeft<1&&(map.playSFX("gong"),this.isDead=!0)},Player.prototype.displayHearts=function(){for(var a=10,b=0;b<this.livesLeft;b++)ctx.drawImage(Resources.get(map.variousImages[4]),a,10),a+=map.tileWidth},Player.prototype.displayTimer=function(){this.bwMsgStyle(),ctx.textAlign="right";var a;a=this.timeLeft>0?Math.ceil(this.timeLeft):"No bonus!",ctx.fillText(a,map.totalWidth-5,50),ctx.strokeText(a,map.totalWidth-5,50)},Player.prototype.displayPoints=function(){this.bwMsgStyle(),ctx.textAlign="right",ctx.drawImage(Resources.get(map.variousImages[1]),map.totalWidth-map.tileWidth,52),ctx.fillText(this.points,map.totalWidth-(5+map.tileWidth),100),ctx.strokeText(this.points,map.totalWidth-(5+map.tileWidth),100)},Player.prototype.displayRound=function(){this.bwMsgStyle(),ctx.font="30px Impact",ctx.textAlign="left",ctx.fillText("Round: "+map.round,10,85),ctx.strokeText("Round: "+map.round,10,85)},Player.prototype.hitOverlay=function(){var a=ctx.createRadialGradient(this.x+map.tileWidth/2,this.y+map.tileWidth,map.tileWidth/2,this.x+map.tileWidth/2,this.y+map.tileWidth,map.tileWidth);a.addColorStop(0,"rgba(255, 0, 0, 0.4)"),a.addColorStop(1,"rgba(255, 0, 0, 0)"),ctx.arc(this.x,this.y+map.tileWidth/2,3*map.tileWidth,0,2*Math.PI),ctx.fillStyle=a,ctx.fill()},Player.prototype.deadOverlay=function(){ctx.fillStyle="rgba(100, 100, 100, 0.5)",ctx.fillRect(0,map.buffer+2*map.tileHeight,map.totalWidth,map.totalHeight)},Player.prototype.victoryBounce=function(a,b){var c=map.tileHeight/4;this.y>a-c&&this.movingUp===!0?this.y-=map.tileWidth*b:this.y<a?(this.movingUp=!1,this.y+=map.tileWidth*b):this.movingUp=!0},Player.prototype.handleInput=function(a){if("mute"!==a)if(this.charSelected)if(this.charSelected&&!this.paused){if("left"===a)return this.floating?void this.waterMove("left"):(0===this.xCoord?this.xCoord=map.numColumns-1:map.canGo(this.xCoord-1,this.yCoord)&&this.xCoord--,void this.move());if("up"===a)return map.canGo(this.xCoord,this.yCoord-1)&&(this.yCoord--,this.floating&&1!==this.yCoord)?void this.waterMove("up"):void this.move();if("right"===a)return this.floating?void this.waterMove("right"):(this.xCoord===map.numColumns-1?this.xCoord=0:map.canGo(this.xCoord+1,this.yCoord)&&this.xCoord++,void this.move());if("down"===a){if(map.canGo(this.xCoord,this.yCoord+1))return this.yCoord++,this.floating&&5!==this.yCoord?void this.waterMove("down"):void this.move()}else if("pause"===a)return void this.togglePause()}else this.victory===!0||this.ouch===!0||this.isDead===!0||this.drowned===!0?"enter"===a&&(this.isDead===!0?(this.keysHeld=0,this.isDead=!1,this.livesLeft=5,map.powerUpCount=0,map.powerUpsLeft=4,allPowerUps.length=0,allClouds.length=0,map.makeKeys(),map.round=1,allDucks.length=0,map.setEnemies(8),this.blurPause(),this.points=0):this.victory===!0&&(this.victory=!1,map.round++,map.makeKeys(),map.addEnemies(1),map.round%2===0&&map.addDucks(1),3===map.round&&allEnemies.push(new Burrower(1)),map.round>=4&&Enemy.prototype.activateZigzag(),5===map.round&&allEnemies.push(new Burrower(2)),
allClouds.length<=15&&map.round>=6&&map.addClouds(1),8===map.round&&allEnemies.push(new Burrower(2)),map.powerUpsLeft=4,this.blurPause()),this.resetTimers(),this.ouch=!1,this.isFood=!1,this.drowned=!1,this.togglePause(),Cloud.prototype.moveNormally(),Burrower.prototype.resetBurrow(),this.sprite=this.charOptions[this.selection],this.resetStart()):"pause"===a&&this.togglePause();else"left"===a?0===this.selection?(this.selectX=this.selectX+112*(this.charOptions.length-1),this.selection=this.charOptions.length-1):(this.selectX=this.selectX-112,this.selection--):"right"===a?this.selection===this.charOptions.length-1?(this.selectX=this.selectX-112*(this.charOptions.length-1),this.selection=0):(this.selectX=this.selectX+112,this.selection++):"enter"===a&&(this.charSelected=!0,this.sprite=this.charOptions[this.selection],this.resetStart(),map.makeKeys());else if(map.audio.muted=!map.audio.muted,map.audio.muted){var b=map.lastTwentySounds.length;map.currentMusic.pause();for(var c=0;b>c;c++)map.lastTwentySounds[c].pause()}else map.playMusic()};var map=new Map;map.makeCoordinates();var player=new Player,allEnemies=[],allCorn=[],allKeys=[],allPowerUps=[],allClouds=[],allDucks=[];map.addEnemies(8),map.addCorn(),window.addEventListener("keydown",function(a){map.disallowedKeys.indexOf(a.keyCode)>-1&&a.preventDefault()},!1),document.addEventListener("keyup",function(a){var b={37:"left",38:"up",39:"right",40:"down",13:"enter",80:"pause",19:"pause",77:"mute"};player.handleInput(b[a.keyCode])});var Engine=function(a){function b(){var a=Date.now(),c=(a-i)/1e3;d(c),f(),i=a,k.requestAnimationFrame(b)}function c(){h(),i=Date.now(),b()}function d(a){e(a)}function e(a){allEnemies.forEach(function(b){b.update(a)}),allCorn.forEach(function(b){b.update(a)}),allKeys.forEach(function(b){b.update(a)}),allPowerUps.forEach(function(b){b.update(a)}),map.update(a),player.update(a),allDucks.forEach(function(b){b.update(a)}),allClouds.forEach(function(b){b.update(a)})}function f(){var a,b,c=map.rowImages,d=map.numRows,e=map.numColumns;for(a=0;d>a;a++)for(b=0;e>b;b++)m.drawImage(Resources.get(c[a]),b*map.tileWidth,a*map.tileHeight),(10===a&&1!==b&&5!==b&&9!==b||6===a&&3!==b&&7!==b)&&m.drawImage(Resources.get(map.variousImages[2]),b*map.tileWidth,a*map.tileHeight-15),2===a&&1!==b&&5!==b&&9!==b&&m.drawImage(Resources.get(map.mapTiles[1]),b*map.tileWidth,a*map.tileHeight);g()}function g(){allCorn.forEach(function(a){a.render()}),allEnemies.forEach(function(a){a.render()}),allKeys.forEach(function(a){a.render()}),allPowerUps.forEach(function(a){a.render()}),player.render(),allDucks.forEach(function(a){a.render()}),allClouds.forEach(function(a){a.render()})}function h(){}var i,j=a.document,k=a.window,l=j.createElement("canvas"),m=l.getContext("2d");l.width=map.totalWidth,l.height=map.totalHeight,j.getElementById("gameDiv").appendChild(l);var n=["images/white-block.png","images/stone-block.png","images/water-block.png","images/water-block2.png","images/grass-block.png","images/enemy-bug-right.png","images/enemy-bug-left.png","images/enemy-bug-up.png","images/enemy-bug-down.png","images/enemy-bug-burrow-1.png","images/enemy-bug-burrow-2.png","images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png","images/char-boy-hurt.png","images/char-cat-girl-hurt.png","images/char-horn-girl-hurt.png","images/char-pink-girl-hurt.png","images/char-princess-girl-hurt.png","images/char-boy-happy.png","images/char-cat-girl-happy.png","images/char-horn-girl-happy.png","images/char-pink-girl-happy.png","images/char-princess-girl-happy.png","images/char-boy-shield.png","images/char-cat-girl-shield.png","images/char-horn-girl-shield.png","images/char-pink-girl-shield.png","images/char-princess-girl-shield.png","images/char-boy-lasso.png","images/char-cat-girl-lasso.png","images/char-horn-girl-lasso.png","images/char-pink-girl-lasso.png","images/char-princess-girl-lasso.png","images/char-boy-water.png","images/char-cat-girl-water.png","images/char-horn-girl-water.png","images/char-pink-girl-water.png","images/char-princess-girl-water.png","images/Selector.png","images/Star.png","images/Rock.png","images/Key.png","images/Heart.png","images/corn.png","images/Green.png","images/Blue.png","images/Orange.png","images/Purple.png","images/Yellow.png","images/Black.png","images/White.png","images/Red.png","images/cloud1.png","images/cloud2.png","images/cloud3.png","images/cloud4.png","images/cloud5.png","images/cloud6.png","images/cloud7.png","images/Arrows.png","images/Mute.png","images/DuckRight.png","images/DuckRightEat.png","images/DuckLeft.png","images/DuckLeftEat.png","images/Enter.png"];Resources.load(n),Resources.onReady(c),a.ctx=m,a.canvas=l}(this);